<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"Server.js.html":{"id":"Server.js.html","title":"Source: Server.js","body":" Accelerator File System Classes Server Source: Server.js 'use strict' import express from 'express' import { graphqlHTTP} from 'express-graphql' import { buildSchema } from 'graphql' import fs from 'fs' import path from 'path' // console.log('graphqlHTTP', graphqlHTTP) const FilesController = (() =&gt; { const api = { list: (req, res) =&gt; { res.json({ok: true}) } } return api })() class FilesRouter extends express.Router { constructor(app) { super() this.get('/', FilesController.list) } } /** * @Class Server * @summary An Express server abstraction implementing a simple graphql API * @description The server class implements an simple graphql API listing files from a speciic directory */ export default class Server { #_app #_schema #_root #_inited constructor() { const self = this this.#_app = express() this.#_setAPISchema() this.#_root = { files: (arg = {}) =&gt; { console.log('xxxxxxxxxxxxx', arg) return Promise.resolve(self.#_getDirectry(arg)) } } this.#_inited = false } /** * @Method Server.setErrorHandler * @summary Set a generic error handler for this server - PRIVATE, not externally callable * @description In a real world app it could be generating logs or sending \"error messages\" to an message queue */ #_setErrorHandler() { this.#_app.use(this.#_errorHandler) } /** * @Method Server.errorHandler * @summary Generic error handler - PRIVATE, not externally callable * @description Intercepts all errors and properly handle those * @param {object} error - the exception information * @param {object} req - the Express request object * @param {object} res - the Express request object * @param {function} next - the Express next() function that is called inside middleware, but in this case, it will not be called. */ #_errorHandler(error, req, res, next) { console.log(error) process.exit(0) } /** * @async * @Method Server.init * @summary Inits the Server instance * @description This method calls express().listen * @return {object} error - if any */ init() { return new Promise((resolve, reject) =&gt; { if (this.#_inited) { return resolve() } this.#_setErrorHandler() this.#_addRouter() this.#_app.listen(process.env.PORT, () =&gt; { this.#_inited = true resolve() console.log(`app running on localhost:${process.env.PORT}/graphql`) }).on('error', function (err) { reject(err) process.exit(0) }) }) } /** * @async * @Method Server.start * @summary Create a Server instance * @description Abstracts the Class initialization once there is no need for running multiple server in this way. &lt;br&gt; * The server will be clustered via pm2. &lt;br&gt; * This method calls express().listen * @return {object} signature - method signature * @return {string|object} signature.error - Execution error * @return {object} signature.server - Server instance */ static async start() { let error = null let server = new Server() try { await server.init() } catch (e) { server = null error = e console.error(e) throw new Error({ error, server }) } return { error, server } } /** * @Method Server.#_setAPISchema() * @summary PRIVATE Set the graphql schema * @description Currently providing two queries: file and files */ #_setAPISchema() { this.#_schema = buildSchema(` type Query { files(dir: String): [File] }, type File { name: String size: Float! fullPath: String } `) } /** * @async * @Method Server.#_getDirectry * @summary PRIVATE - List itens from given file system directory * @description By default it will to list content from ./ * By default, this API will allow to list content starting on API application directory.&lt;br&gt; */ async #_getDirectry(args = {}) { let _dir = __dirname const all = [] if (args.dir) { _dir = path.resolve(`./${args.dir}`) } let { error, files } = await this.#_readDir(_dir) for (let x = 0; x &lt; files.length; x++) { let name = files[x] let fullPath = `${_dir}/${name}` const { size } = fs.statSync(fullPath) all.push({ name, size: size.toFixed(4), fullPath }) } // console.log(all) return all } #_readDir(dir) { return new Promise((resolve, reject) =&gt; { fs.readdir(dir, (error, files) =&gt; { if (error) { return resolve({ error, files: null }) } resolve({ error: null, files }) }) }) } #_addRouter() { // this.#_app.use('/', new FilesRouter(this)) this.#_app.use('/graphql', graphqlHTTP({ schema: this.#_schema, rootValue: this.#_root })) } } × Search results Close "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" Accelerator File System Classes Server Classes Classes Server An Express server abstraction implementing a simple graphql API × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" Accelerator File System Classes Server Accelerator File System API - POC | × Search results Close "},"Server.html":{"id":"Server.html","title":"Class: Server","body":" Accelerator File System Classes Server Class: Server Server new Server() An Express server abstraction implementing a simple graphql API The server class implements an simple graphql API listing files from a speciic directory Source: Server.js, line 29 Methods &lt;async, static&gt; _getDirectry() PRIVATE - List itens from given file system directory By default it will to list content from ./ By default, this API will allow to list content starting on API application directory. Source: Server.js, line 144 &lt;static&gt; _setAPISchema()() PRIVATE Set the graphql schema Currently providing two queries: file and files Source: Server.js, line 126 &lt;static&gt; errorHandler(error, req, res, next) Generic error handler - PRIVATE, not externally callable Intercepts all errors and properly handle those Parameters: Name Type Description error object the exception information req object the Express request object res object the Express request object next function the Express next() function that is called inside middleware, but in this case, it will not be called. Source: Server.js, line 62 &lt;async, static&gt; init() Inits the Server instance This method calls express().listen Source: Server.js, line 75 Returns: error - if any Type object &lt;static&gt; setErrorHandler() Set a generic error handler for this server - PRIVATE, not externally callable In a real world app it could be generating logs or sending \"error messages\" to an message queue Source: Server.js, line 54 &lt;async, static&gt; start() Create a Server instance Abstracts the Class initialization once there is no need for running multiple server in this way. The server will be clustered via pm2. This method calls express().listen Source: Server.js, line 100 Returns: signature - method signature Type object signature.error - Execution error Type string | object signature.server - Server instance Type object × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
